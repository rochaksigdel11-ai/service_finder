{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% block title %}{{ service.titleOverview }}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- Service Info -->
        <div class="col-lg-8">
            <div class="card mb-4 shadow-sm">
                <div class="card-body">
                    <h2>{{ service.titleOverview }}</h2>
                    <p class="text-muted">By <strong>{{ user_profile.user.username }}</strong></p>
                    <p class="badge bg-success fs-6">{{ service.overall_rating|floatformat:1 }} ★</p>
                    <p>{{ description.description|linebreaks }}</p>
                </div>
            </div>

            <!-- Packages -->
            <h4>Packages</h4>
            <div class="row">
                {% for pkg in basic_packages %}
                <div class="col-md-4">
                    <div class="card mb-3 border-success">
                        <div class="card-header bg-success text-white"><strong>Basic</strong></div>
                        <div class="card-body">
                            <h5>NPR {{ pkg.Basic_price }}</h5>
                            <p>{{ pkg.Basic_description|truncatewords:15 }}</p>
                            <small>{{ pkg.Basic_delivery_time }} days • {{ pkg.Basic_revisions }} revisions</small>
                        </div>
                    </div>
                </div>
                {% endfor %}
                <!-- Repeat for standard, premium -->
            </div>

            <!-- Gallery -->
            {% if gallery %}
            <div class="card mt-4">
                <div class="card-header"><h5>Gallery</h5></div>
                <div class="card-body">
                    <div class="row">
                        {% if gallery.image1 %}<div class="col-4"><img src="{{ gallery.image1.url }}" class="img-fluid rounded"></div>{% endif %}
                        {% if gallery.image2 %}<div class="col-4"><img src="{{ gallery.image2.url }}" class="img-fluid rounded"></div>{% endif %}
                        {% if gallery.image3 %}<div class="col-4"><img src="{{ gallery.image3.url }}" class="img-fluid rounded"></div>{% endif %}
                    </div>
                    {% if gallery.video %}
                    <video controls class="w-100 mt-3"><source src="{{ gallery.video.url }}"></video>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Reviews -->
            <div class="card mt-4">
                <div class="card-header"><h5>Reviews ({{ review_count }})</h5></div>
                <div class="card-body">
                    {% for r in ratings %}
                    <div class="border-bottom pb-3 mb-3">
                        <strong>{{ r.reviewer.user.username }}</strong> 
                        <span class="text-warning">{% for i in "12345"|make_list %}{% if forloop.counter <= r.review_rating %}★{% else %}☆{% endif %}{% endfor %}</span>
                        <p>{{ r.review }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Sidebar: Order -->
        <div class="col-lg-4">
            <div class="card shadow-sm sticky-top">
                <div class="card-body">
                    <h5>Order Now</h5>
                    <form method="post">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label>Rating</label>
                            <input type="number" name="rating" min="1" max="5" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label>Title</label>
                            <input type="text" name="title" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label>Review</label>
                            <textarea name="review" class="form-control" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-success w-100">Submit Review</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}